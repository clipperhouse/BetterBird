<html>
  <script>
    //React when a browser action's icon is clicked.
    chrome.browserAction.onClicked.addListener(function(tab) {
    	chrome.tabs.query({ url : "*://twitter.com/*" }, function (tabs) {
    		var tabid;
    		if (tabs.length) {
    			tabid = tabs[0].id;
    			chrome.tabs.update(tabid, { active: true });
    			chrome.tabs.sendRequest(tabid, "go-home");
    		} else {
	    		chrome.tabs.create({ url : "http://twitter.com" }, function(tab) {
	    			tabid = tab.id;
	    		});
			}
    	});
    });

    var optionskey = "options";
    var defaultoptions = {
        "columnswitch": true,
        "columnwide":true,
        "fontgeorgia": true,
        "fontverdana": false,
        "expandurls": true,
        "directtoprofile": true,
        "savedsearches": true
    };

    var loadOptions = function () {
        var options = localStorage[optionskey];
        if (options){
            return JSON.parse(options);
        }
        return defaultoptions;
    };

    var saveOptions = function (options) {
        localStorage[optionskey] = JSON.stringify(options);
        return true;
    };

    chrome.extension.onRequest.addListener(function(request, sender, sendResponse) {
        var response;
        switch(request.type) {
            case "load-options":
              response = loadOptions();
              break;
            case "save-options":
              response = { success: saveOptions(request.options) };
              break;
            default:
              response = {};
        }
        sendResponse(response)
    });
  </script>
</html>