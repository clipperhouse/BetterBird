(function(){var H,F,J,N,n,G,M,e,Q,v,j,C,i,o,u,f,s,y,z,K,O,a,x,S,V,m,L,w,r,p,g,h,c,B,T,E,q,A,X,Y,W,b,U,D,I,l,R,d,P,k,t;G={module:"bb-module",expand:"bb-expand",direct:"bb-direct",savedsearch:"bb-savedsearch",options:"bb-options",birdblock:"bb-birdblock",content:"bb-content",mentions:"bb-mentions",notify:"bb-notify",clear:"bb-clear"};
M={originaltext:"bb-originaltext",originalhref:"bb-originalhref",count:"bb-count"};(function(aa){var Z;Z=function(){return aa("<small>").addClass(G.notify).data(M.count,0);
};aa.fn.addNotifier=function(){return this.append(Z());};aa.fn.appendNotifier=function(){return this.append(Z());};aa.fn.appendClear=function(ab){var ac;
if(ab){ac=aa("<a>").addClass(G.clear).text("Clear").click(function(){ab();return false;});return this.append(" &nbsp; ").append(ac);}return this;};aa.fn.getNotifier=function(){var ac,ab;
if(this.isNotifier()){return this;}ab="small."+G.notify;ac=this.find(ab);if(ac.length){return ac;}return this.next(ab);};aa.fn.getNotifierCount=function(){return this.getNotifier().data(M.count);
};aa.fn.updateNotifier=function(ac,ab){var ad;ad=this.getNotifier();if(ab){ac+=ad.getNotifierCount();}if(ad.length){if(ac>0){return ad.data(M.count,ac).text(ac+" new");
}return ad.data(M.count,ac).text("");}return this;};aa.fn.incrementNotifier=function(ab){return this.updateNotifier(ab,true);};aa.fn.isNotifier=function(){return this.hasClass(G.notify);
};aa.fn.hasNotifier=function(){return this.getNotifier().length>0;};return aa.fn.clearNotifier=function(){return this.getNotifier().text("").data(M.count,0);
};})(jQuery);O=function(Z){return(Z.text!=null)&&Z.text.indexOf("RT ")!==0;};a=function(Z){return function(aa){return(aa.from_user!=null)&&aa.from_user!==Z.remove("@");
};};v=$(document.body);t=$("div.wrapper");s=$("div.dashboard",t);Q=void 0;L=void 0;q=void 0;r=void 0;g={scheme:/^http[s]?:\/\/(www\.)*/,trailingid:/\/\d+$/g,trailing:/[\/\-\.\s]$/,fileext:/(.html|.htm|.jpg|.php|.aspx|.story)/i,querystring:/\?.*$/,nyt:/www10\.nytimes/,urlparts:/[\/\?]+/g};
S={base:chrome.extension.getURL("img/twitter_32.png"),notify:chrome.extension.getURL("img/twitter_32_notify.png")};j=function(Z){return chrome.extension.sendRequest({type:"check-update"},Z);
};n=function(Z){var aa;for(aa in Z.styles){G[aa]="bb-"+aa;v.toggleClass(G[aa],Z.styles[aa]);}return $("div#page-node-home").show();};F=function(Z){var aa;
Z=decodeURIComponent(Z).remove(g.scheme);if(Z.split(g.urlparts).length<=2){return Z;}aa=Z.replace(g.nyt,"nytimes").remove(g.querystring).remove(g.fileext).remove(g.trailing).remove(g.trailingid).split(g.urlparts);
if(aa.length<=2){return aa.join("/");}aa.splice(1,aa.length-2,"…");aa[this.length]=aa[this.length].split("-").slice(0,6).join("-").split("_").slice(0,6).join("_");
return aa.join("/");};K=function(){return $("a[data-ultimate-url], a[data-expanded-url]").not("a."+G.expand).each(function(){var Z,aa;Z=$(this);aa=(Z.data("ultimate-url")||Z.data("expanded-url")).replace(g.nyt,"nytimes");
return Z.data(M.originaltext,$(this).text()).href(aa).text(F(aa)).addClass(G.expand).removeAttr("data-ultimate-url").removeAttr("data-expanded-url");});
};B=function(){return $("a."+G.expand).filterByData(M.originaltext).each(function(){var Z;Z=$(this);return Z.text(Z.data(M.originaltext)).removeClass(G.expand);
});};e=[];o=function(ad,af,ag){var ae,ac,ab,aa,Z;ab=$("<h3>").text(af).title("Hover to expand");ae=$("<div>").addClass(G.content).toggle(!w.collapse[ad.removePrefix()]);
ac=$("<div class='flex-module' />").append(ab).append(ae);Z=$("<div class='module' />").addClass(G.module).addClass(ad).append(ac);aa=void 0;if(ag){aa=$("<img>").addClass("bb-icon").src(ag);
ab.append(aa);}Z.content=ae;Z.title=ab;Z.icon=aa;Z.clearAllNotifiers=function(){Z.content.findByClass(G.notify).updateNotifier(0);R(Z);return U(true);};
Z.hoverIntent((function(){return Z.content.slideDown("fast");}),function(){if(!ab.hasNotifier()||ab.getNotifierCount()===0){return Z.content.slideUp();
}});Z.hover((function(){return $(this).findByClass(G.clear).fadeIn("fast");}),function(){return $(this).findByClass(G.clear).fadeOut("fast");});e.push(Z);
return Z;};U=function(Z){return chrome.extension.sendRequest({type:"set-icon",notify:Z});};d=function(){var Z;Z=0;return e.forEach(function(aa){var ac,ab;
ab=aa.title.getNotifier().first();if(ab.length){ac=ab.getNotifierCount();if(!aa.is(":hover")){if(ac){aa.content.slideDown();}else{aa.content.slideUp();
}}return Z+=ac;}});};R=function(Z){var ac,aa,ab;aa=Z.content.findByClass(G.notify);ab=0;aa.each(function(){return ab+=$(this).getNotifierCount();});ac=Z.title.getNotifier();
if(ab>0){ac.updateNotifier(ab).appendClear(Z.clearAllNotifiers).fadeIn("fast");Z.icon.addClass(G.notify).src(S.notify);}else{ac.fadeOut("fast").updateNotifier(0);
Z.icon.removeClass(G.notify).src(S.base);}return ab;};f=function(){q=o(G.savedsearch,"Saved Searches",S.base);q.title.appendNotifier(q.clearAllNotifiers);
q.hide();return Q.append(q);};A=[];X=150;b=void 0;W=function(){$("#search-query").focus().blur();f();return p();};p=function(){b=$(".typeahead-searches[data-search-query]");
if(b.length>0){return E();}return setTimeout(p,1000);};l=function(){var Z;Z=$("a[data-search-query]",b);return A=$.map(Z,function(aa){return $(aa).data("search-query");
});};E=function(){var Z;l();A.forEach(z);if(A.length){q.show();}Z=60*60*1000*(A.length+1)/X;return setTimeout(E,Z);};z=function(Z){return chrome.extension.sendRequest({type:"do-search",q:Z},I);
};I=function(ab){var Z,ac,aa,ad;ad=decodeURIComponent(ab.query).replace("+"," ");ac=ab.results.filter(O).length;aa="search-query";Z=q.content.findByData("a",aa,ad);
if(Z.length===0){Z=$("<a>").data(aa,ad).href("/#!/search/realtime/"+encodeURIComponent(ad)).text(ad).addNotifier().click(function(){$(this).clearNotifier();
return R(q);});q.content.append($("<p>").append(Z));}Z.incrementNotifier(ac);return R(q);};V=[];Y=function(){var Z,aa;i();Z=$("a.account-summary div.account-group").first();
V=$.map(Z,function(ab){return"@"+$(ab).data("screen-name");});if(V.length){m();aa=60*60*1000*(A.length+1)/X;return setInterval(m,aa);}};i=function(){L=o(G.mentions,"Mentions",S.base);
L.title.appendNotifier();L.content.hide();return q.before(L);};D=function(ab){var Z,ac,aa,ad;ad=decodeURIComponent(ab.query).replace("+"," ");ac=ab.results.filter(O).filter(a(ad)).length;
aa="search-query";Z=L.content.findByData("a",aa,ad);if(Z.length===0){Z=$("<a>").data(aa,ad).href("/#!/mentions/").text(ad).addNotifier().click(function(){$(this).clearNotifier();
return R(L);});L.content.append($("<p>").append(Z));}Z.incrementNotifier(ac);return R(L);};m=function(){return V.forEach(y);};y=function(Z){return chrome.extension.sendRequest({type:"do-search",q:Z},D);
};h=function(){return $("a[data-ultimate-url], a[data-expanded-url]").not("a."+G.direct).each(function(){var Z,aa;Z=$(this);aa=Z.data("ultimate-url")||Z.data("expanded-url");
aa=aa.replace(g.nyt,"nytimes");return Z.data(M.originalhref,$(this).href()).href(aa).addClass(G.direct);});};c=function(){return $("a."+G.direct).filterByData(M.originalhref).each(function(){var Z;
Z=$(this);return Z.href(Z.data(M.originalhref)).removeClass(G.direct);});};u=function(){r=o(G.options,"Better Bird settings",chrome.extension.getURL("img/twitter_32.png"));
J("expandurls","Expand URLs",function(Z){if(Z===true){K();return h();}else{B();return c();}});N("columnswitch","Switch columns");N("columnwide","Widen content");
N("font","Use serif font");N("hidediscover","Hide #Discover");N("hidepromoted","Hide Promoted tweets");N("hidewho","Hide “Who to follow”");N("hidetrends","Hide “Trends”");
r.content.append($("<p>").append($("<small>").append("Created by ").append($("<a>").text("Matt Sherman").href("/#!/clipperhouse"))));return j(function(Z){if(!Z){r.content.hide();
}return Q.append(r);});};J=function(ac,ad,ae){var ab,Z,aa;Z=$("<input type='checkbox'>").id("bb-option-"+ac).checked(w[ac]).change(function(){w[ac]=$(this).is(":checked");
T();if(ae){return ae(w[ac]);}});aa=$("<label>").text(ad).attrfor(Z);ab=$("<br>");return r.content.append(Z).append(aa).append(ab);};N=function(ac,ad){var ab,Z,aa;
Z=$("<input type='checkbox'>").id("bb-option-style-"+ac).checked(w.styles[ac]).change(function(){w.styles[ac]=$(this).is(":checked");v.toggleClass(G[ac],w.styles[ac]);
return T();});aa=$("<label>").text(ad).attrfor(Z);ab=$("<br>");return r.content.append(Z).append(aa).append(ab);};C=function(){Q=$("<div>").addClass(G.birdblock);
return $("div.mini-profile",s).after(Q);};k=function(){var Z,aa;Z=$("<div>").addClass("bb-wrapper-trends");$("div.module.trends",s).wrap(Z);aa=$("<div>").addClass("bb-wrapper-who");
return $("div[data-component-term='user_recommendations']",s).wrap(aa);};w=void 0;T=function(){return chrome.extension.sendRequest({type:"save-options",options:w});
};x=function(){return chrome.extension.sendRequest({type:"has-run"});};P=void 0;H={Init:function(){clearInterval(P);chrome.extension.sendRequest({type:"load-options"},function(Z){w=Z;
n(w);setTimeout((function(){C();P=setInterval(function(){var aa;aa=$("div.stream");if(w.expandurls){K();return h();}},1500);if(w.savedsearches){W();Y();
}u();setInterval(d,2000);return k();}),1500);return $(window).unload(function(){return x();});});return chrome.extension.onRequest.addListener(function(aa,Z,ab){switch(aa.type){case"go-home":document.location.href=$("li#global-nav-home > a").href();
return scroll(0,0);}});}};if($(document.body).is(".logged-in")){H.Init();}}).call(this);